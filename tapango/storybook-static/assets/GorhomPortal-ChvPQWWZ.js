import{r as n}from"./index-D_zSVikN.js";import{j as i}from"./jsx-runtime-BjG_zV1W.js";import{f as T,h as b,j as C}from"./ThemeProvider-BSGpWKhi.js";import{r as g}from"./index-VT2245Mq.js";const m=n.createContext(null),X=e=>{const t=n.useContext(m);return i.jsx(m.Provider,{value:e.disable?t:null,children:e.children})},A=e=>{n.startTransition(e)};typeof globalThis.__DEV__>"u"&&(globalThis.__DEV__=!1);const E=n.createContext(1),y=n.createContext(void 0);var j={};const l={},x={},S=e=>{if(j.TAMAGUI_STACK_Z_INDEX_GLOBAL){const{stackZIndex:t,zIndex:r}=e,o=n.useId(),a=n.useMemo(()=>{if(t&&t!=="global"&&r===void 0){const s=Object.values(x).reduce((d,u)=>Math.max(d,u),0);return Math.max(t===!0?1:t,s+1)}return r??1e3},[t]);return n.useEffect(()=>{if(typeof t=="number")return x[o]=t,()=>{delete x[o]}},[t]),a}else{const{stackZIndex:t,zIndex:r}=e,o=n.useId(),a=n.useContext(E),s=t==="global"?0:a,d=n.useContext(y);l[s]||(l[s]={});const u=l[s],c=n.useMemo(()=>{if(typeof r=="number")return r;if(t){if(d)return d+1;const h=Object.values(u).reduce((v,p)=>Math.max(v,p),0),f=s*5e3+h+1;return typeof t=="number"?t+f:f}return 1},[s,r,t]);return n.useEffect(()=>{if(t)return u[o]=c,()=>{delete u[o]}},[c]),c}},M=e=>({stackZIndex:e.stackZIndex,zIndex:Z(e.zIndex)}),Z=e=>typeof e>"u"||e==="unset"?void 0:typeof e=="number"?e:T(e,"zIndex"),q=n.memo(e=>{var s;if(b)return null;const t=(s=globalThis.document)==null?void 0:s.body;if(!t)return e.children;const{children:r,passThrough:o}=e,a=S(M(e));return o?r:g.createPortal(i.jsx("span",{style:{zIndex:a,position:"fixed",inset:0,contain:"strict",pointerEvents:"none"},children:r}),t)});var I={};const k=typeof globalThis<"u"&&!!(globalThis._IS_FABRIC??globalThis.nativeFabricUIManager),J=I.TAMAGUI_USE_NATIVE_PORTAL&&I.TAMAGUI_USE_NATIVE_PORTAL!=="false"?!0:!k,_=new Map,R={},U={},P=(e,t)=>(t in e||(e[t]=[]),e),L=(e,t)=>(delete e[t],e),V=(e,t,r,o)=>{t in e||(e=P(e,t));const a=e[t].findIndex(s=>s.name===r);return a!==-1?e[t][a].node=o:e[t].push({name:r,node:o}),e},z=(e,t,r)=>{if(!(t in e))return console.info(`Failed to remove portal '${r}', '${t}' was not registered!`),e;const o=e[t].findIndex(a=>a.name===r);return o!==-1&&e[t].splice(o,1),e},D=(e,t)=>{const{type:r}=t;switch(r){case 0:return P({...e},t.hostName);case 1:return L({...e},t.hostName);case 2:return V({...e},t.hostName,t.portalName,t.node);case 3:return z({...e},t.hostName,t.portalName);default:return e}},H=n.createContext(null),O=n.createContext(null),w=({rootHostName:e="root",shouldAddRootHost:t=!0,children:r})=>{const[o,a]=n.useReducer(D,U),s=n.useMemo(()=>d=>{A(()=>{a(d)})},[a]);return i.jsx(O.Provider,{value:s,children:i.jsxs(H.Provider,{value:o,children:[r,t&&i.jsx(G,{name:e})]})})},F=n.memo(w);F.displayName="PortalProvider";const G=n.memo(function(e){return i.jsx($,{...e})});function $(e){return C(()=>()=>{_.delete(e.name)},[e.name]),i.jsx("div",{style:{display:"contents"},ref:t=>{var r;t&&(_.set(e.name,t),(r=R[e.name])==null||r.forEach(o=>o(t)))}})}export{F as P,X as R,J as U,E as Z,m as a,y as b,_ as c,G as d,q as e,R as p,Z as r,A as s};
