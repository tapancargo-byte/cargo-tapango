import{u as k,R as c,s as i,j as e,C as f,a as p,b as v,c as y,I as S,B as m,T as R,d as T,e as C,f as n,g as U,h as o,i as _}from"./index-uqNopkIn.js";function P(){const{isAdmin:N}=k(),[j,g]=c.useState([]),[d,D]=c.useState("all"),[u,E]=c.useState(""),[b,K]=c.useState(null),[x,V]=c.useState(null),l=c.useCallback(async()=>{if(!i||!N)return;const{data:a,error:s}=await i.storage.from("kyc").list("",{limit:100,search:u||void 0});if(!s&&a){const{data:r}=await i.from("kyc_reviews").select("path,status"),w=new Map((r??[]).map(t=>[t.path,t.status]));g(a.map(t=>({...t,status:w.get(t.name)??"pending"})))}else g([])},[N,u]);c.useEffect(()=>{l()},[l]);const h=j.filter(a=>d==="all"||(a.status??"pending")===d);return e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"flex justify-between items-center",children:e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"text-3xl font-bold tracking-tight","data-testid":"kyc-title",children:"KYC Review"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:40,columnNumber:11},this),e.jsxDEV("p",{className:"text-muted-foreground",children:"Moderate driver identity documents"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:41,columnNumber:11},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:39,columnNumber:9},this)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:38,columnNumber:7},this),e.jsxDEV(f,{children:[e.jsxDEV(p,{children:e.jsxDEV(v,{"data-testid":"kyc-filters",children:"Filters"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:47,columnNumber:11},this)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:46,columnNumber:9},this),e.jsxDEV(y,{children:e.jsxDEV("div",{className:"flex flex-wrap gap-3 items-end",children:[e.jsxDEV("div",{className:"min-w-[220px]",children:[e.jsxDEV("label",{className:"block text-xs text-muted-foreground mb-1",children:"Search"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:52,columnNumber:15},this),e.jsxDEV(S,{placeholder:"Search filename",value:u,onChange:a=>E(a.target.value)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:53,columnNumber:15},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:51,columnNumber:13},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs text-muted-foreground mb-1",children:"Status"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:56,columnNumber:15},this),e.jsxDEV("select",{className:"border rounded h-9 px-2",value:d,onChange:a=>D(a.target.value),children:[e.jsxDEV("option",{value:"all",children:"All"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:58,columnNumber:17},this),e.jsxDEV("option",{value:"pending",children:"Pending"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:59,columnNumber:17},this),e.jsxDEV("option",{value:"approved",children:"Approved"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:60,columnNumber:17},this),e.jsxDEV("option",{value:"rejected",children:"Rejected"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:61,columnNumber:17},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:57,columnNumber:15},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:55,columnNumber:13},this),e.jsxDEV(m,{onClick:l,children:"Reload"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:64,columnNumber:13},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:50,columnNumber:11},this)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:49,columnNumber:9},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:45,columnNumber:7},this),e.jsxDEV(f,{children:[e.jsxDEV(p,{children:e.jsxDEV(v,{"data-testid":"kyc-docs",children:["Documents (",h.length,")"]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:71,columnNumber:11},this)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:70,columnNumber:9},this),e.jsxDEV(y,{children:[e.jsxDEV(R,{children:[e.jsxDEV(T,{children:e.jsxDEV(C,{children:[e.jsxDEV(n,{children:"Path"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:77,columnNumber:17},this),e.jsxDEV(n,{children:"Status"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:78,columnNumber:17},this),e.jsxDEV(n,{children:"Last Modified"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:79,columnNumber:17},this),e.jsxDEV(n,{children:"Actions"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:80,columnNumber:17},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:76,columnNumber:15},this)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:75,columnNumber:13},this),e.jsxDEV(U,{children:h.map(a=>e.jsxDEV(C,{children:[e.jsxDEV(o,{children:a.name},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:86,columnNumber:19},this),e.jsxDEV(o,{children:e.jsxDEV(_,{className:"bg-gray-100 dark:bg-gray-800 border border-gray-300/50",children:a.status??"pending"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:88,columnNumber:21},this)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:87,columnNumber:19},this),e.jsxDEV(o,{children:new Date(a.last_modified).toLocaleString()},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:92,columnNumber:19},this),e.jsxDEV(o,{children:e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV(m,{variant:"secondary",onClick:async()=>{const{data:s}=await i.storage.from("kyc").createSignedUrl(a.name,300);K(s?.signedUrl??null),V(a.name)},children:"Preview"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:95,columnNumber:23},this),e.jsxDEV(m,{variant:"outline",onClick:async()=>{const{data:s}=await i.storage.from("kyc").createSignedUrl(a.name,600),r=s?.signedUrl;r&&window.open(r,"_blank")},children:"Download"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:100,columnNumber:23},this),e.jsxDEV(m,{onClick:async()=>{const{data:s}=await i.auth.getUser(),r=s?.user?.email??s?.user?.id??"admin";await i.from("kyc_reviews").upsert({path:a.name,status:"approved",reviewed_by:r}),await l()},children:"Approve"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:104,columnNumber:23},this),e.jsxDEV(m,{variant:"destructive",onClick:async()=>{const{data:s}=await i.auth.getUser(),r=s?.user?.email??s?.user?.id??"admin";await i.from("kyc_reviews").upsert({path:a.name,status:"rejected",reviewed_by:r}),await l()},children:"Reject"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:110,columnNumber:23},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:94,columnNumber:21},this)},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:93,columnNumber:19},this)]},`${a.name}-${a.last_modified}`,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:85,columnNumber:17},this))},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:83,columnNumber:13},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:74,columnNumber:11},this),b&&x&&e.jsxDEV("div",{className:"mt-4",children:[e.jsxDEV("div",{className:"text-sm text-muted-foreground",children:["Preview: ",x]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:125,columnNumber:15},this),e.jsxDEV("img",{src:b,alt:"Preview",className:"mt-2 rounded border max-h-[420px]"},void 0,!1,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:126,columnNumber:15},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:124,columnNumber:13},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:73,columnNumber:9},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:69,columnNumber:7},this)]},void 0,!0,{fileName:"C:/cargo/admin/src/pages/Kyc.tsx",lineNumber:37,columnNumber:5},this)}export{P as default};
//# sourceMappingURL=Kyc-DNE-Lxbj.js.map
