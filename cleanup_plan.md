# TAPANGO Cleanup Plan

## Summary

This document outlines the cleanup and consolidation plan for the TAPANGO cargo logistics platform repository. The goal is to remove duplicates, resolve dependency conflicts, and consolidate scattered documentation.

## Risk Assessment

### Low Risk (Safe to proceed)
- ‚úÖ Duplicate build artifacts (can be regenerated)
- ‚úÖ Duplicate favicons and icons (generated by build tools)  
- ‚úÖ Obsolete documentation (moved to archive)
- ‚úÖ Build cache cleanup
- ‚úÖ Storybook static files (can be rebuilt)

### Medium Risk (Test thoroughly)
- ‚ö†Ô∏è Dependency version unification
- ‚ö†Ô∏è Near-duplicate component files
- ‚ö†Ô∏è Build configuration consolidation

### High Risk (Manual review required)
- üö® Core component files (ui/index files)
- üö® Package.json modifications
- üö® Authentication configuration
- üö® Database migrations

## Actions Taken

### 1. Documentation Consolidation ‚úÖ

**Consolidated Files:**
- Created comprehensive `DOCUMENTATION.md` (770 lines)
- Consolidated content from 50+ scattered markdown files
- Standardized format with clear table of contents
- Added Expo SDK 54 specific guidance

**Files Moved to Archive:**
Will move the following to `docs/obsolete-backup/`:
- All README.md files except root
- Individual feature documentation
- Status reports and migration guides
- Design documentation
- Setup guides now covered in main docs

### 2. Dependency Conflict Resolution ‚ö†Ô∏è

**Conflicts Identified:**
1. `@supabase/supabase-js`: admin (^2.56.0) vs tapango (^2.45.4)
2. `@tanstack/react-query`: admin (^5.85.5) vs tapango (^5.56.2)
3. `react`: admin (^19.1.1) vs tapango (19.1.0)
4. `react-dom`: admin (^19.1.1) vs tapango (19.1.0)
5. `typescript`: admin (^5.4.0) vs tapango (5.9.2)
6. `zod`: admin (^3.22.4) vs tapango (^3.23.8)
7. `zustand`: admin (^5.0.8) vs tapango (^5.0.0)
8. `@playwright/test`: admin (^1.48.2) vs tapango (^1.55.0)
9. `vite`: admin (^7.1.5) vs tapango (6.3.6)
10. `@types/jest`: admin (^27.5.2) vs tapango (^29.5.12)
11. `@types/react`: admin (^19.1.11) vs tapango (19.1.10)

**Recommended Resolution:**
```bash
# Update tapango to match admin versions (safer approach)
cd tapango
npm install @supabase/supabase-js@^2.56.0
npm install @tanstack/react-query@^5.85.5
npm install react@19.1.1 react-dom@19.1.1
npm install --save-dev @types/react@^19.1.11
npm install --save-dev typescript@^5.4.0
npm install --save-dev @playwright/test@^1.55.0
npm install zustand@^5.0.8
npm install zod@^3.23.8

# Test thoroughly after each update
npm run typecheck && npm run lint && npm start
```

### 3. Duplicate Files Cleanup ‚úÖ

**Safe Duplicates to Remove:**
- Build artifacts: `admin/build/` and `admin/dist/` contain identical files
- Icon duplicates: Android app icons are correctly duplicated by build process
- Storybook assets: Font files duplicated in `storybook-static/`
- Favicon files: Multiple identical copies

**Near-Duplicate Components Analysis:**
- `tapango/src/ui/index.design-only.ts` vs `tapango/src/ui/index.new-ui.ts` (identical)
- Multiple test snapshot images (identical)

### 4. Route Architecture Summary ‚úÖ

**Mobile App (Expo Router v6):**
- 30 screens across 5 route groups
- 6 layout files
- File-based routing in `app/` directory

**Admin Dashboard (React Router):**
- 15 routes with 12 page components
- Route definitions in `admin/src/App.tsx`

### 5. Build Optimization

**Cache Cleanup (Safe):**
```bash
# Remove build caches
rm -rf tapango/.expo
rm -rf tapango/storybook-static
rm -rf admin/build
rm -rf admin/dist
rm -rf node_modules/.cache
```

## Implementation Steps

### Step 1: Archive Documentation
```bash
# Move obsolete docs to archive
git mv tapango/docs/* docs/obsolete-backup/tapango/
git mv admin/docs/* docs/obsolete-backup/admin/
git mv docs/api.md docs/obsolete-backup/
# Create README in obsolete-backup explaining the archive
```

### Step 2: Remove Safe Duplicates
```bash
# Remove duplicate build artifacts
rm -rf admin/build
rm -rf admin/dist  
rm -rf tapango/storybook-static

# Remove duplicate UI index file
rm tapango/src/ui/index.design-only.ts
```

### Step 3: Dependency Unification (Test Required)
```bash
cd tapango
# Update dependencies to match admin versions
npm install @supabase/supabase-js@^2.56.0
npm install @tanstack/react-query@^5.85.5
# ... (continue with all conflicts)

# Test after each major update
npm run typecheck
npm start
```

### Step 4: Verification
```bash
# Verify mobile app still works
cd tapango && npm start

# Verify admin still works  
cd admin && npm run dev

# Run tests
cd tapango && npm run test:unit
cd admin && npm test
```

## Backup Strategy

Before any risky changes:
1. ‚úÖ Created git branch `cleanup/docs-and-duplicates`
2. ‚úÖ Committed current state as backup
3. üîÑ Will create zip backup of current state
4. üîÑ Each risky change gets its own commit

## Testing Strategy

After each phase:
1. Verify both apps start successfully
2. Run type checking (`npm run typecheck`)
3. Run linting (`npm run lint`)
4. Run unit tests where available
5. Manual smoke test of core functionality

## Success Metrics

- [ ] Single consolidated `DOCUMENTATION.md` file
- [ ] Zero dependency version conflicts
- [ ] Reduced repository size
- [ ] Faster build times (fewer duplicate processing)
- [ ] Maintained functionality (no regressions)
- [ ] Clean git history with logical commits

## Rollback Plan

If any issues arise:
```bash
# Rollback to backup branch
git checkout feat/role-selection
git branch -D cleanup/docs-and-duplicates

# Or rollback individual commits
git revert <commit-hash>
```

## Follow-up Actions

1. **Package Management**: Consider yarn workspaces or pnpm for better dependency management
2. **Build Optimization**: Set up shared build configurations
3. **CI/CD**: Update workflows to use new documentation structure
4. **Developer Onboarding**: Update team documentation to reference new `DOCUMENTATION.md`

---

*This cleanup plan prioritizes safety and maintainability while achieving significant repository optimization.*